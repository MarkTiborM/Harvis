# Default values for harvis-ai.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global configuration
global:
  namespace: ai-agents
  storageClass: ""  # Use default storage class

# Backend configuration
backend:
  enabled: false  # Using merged deployment instead
  env:
    # Secrets will be provided via external secrets or at deployment time
    # Do not commit actual secret values to Git!
    JWT_SECRET: ""  # Will be set via --set flag or external secret
    OLLAMA_CLOUD_URL: "https://coyotegpt.ngrok.app/ollama"
    OLLAMA_API_KEY: ""  # Will be set via --set flag or external secret
    OPENAI_API_KEY: ""  # Will be set via --set flag or external secret
  image:
    repository: dulc3/jarvis-backend
    tag: latest
    pullPolicy: Always
  resources:
    requests:
      cpu: 250m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi
  persistence:
    enabled: false  # Backend persistence disabled since using merged deployment
    size: 5Gi
    storageClass: ""
    accessMode: ReadWriteOnce

# Merged Ollama + Backend deployment configuration
mergedOllamaBackend:
  enabled: true
  # Ollama container configuration
  ollama:
    image:
      repository: ollama/ollama
      tag: latest
      pullPolicy: IfNotPresent
    resources:
      requests:
        cpu: 500m
        memory: 2Gi
      limits:
        cpu: 1000m
        memory: 4Gi
    models:
      - mistral
      - codellama
  # Overall resource configuration (GPU allocation)
  resources:
    requests:
      cpu: 500m
      memory: 2Gi
      nvidia.com/gpu: 1
    limits:
      cpu: 2000m
      memory: 8Gi
      nvidia.com/gpu: 1
    gpu: 1
  service:
    type: ClusterIP
    port: 8000
  persistence:
    existingClaim: ""  # Use default claim name if empty

# Frontend configuration
frontend:
  enabled: true
  image:
    repository: dulc3/jarvis-frontend
    tag: dev
    pullPolicy: Always
  env:
    # Secrets will be provided via external secrets or at deployment time
    JWT_SECRET: ""  # Will be set via --set flag or external secret
    NODE_ENV: "production"
    NEXT_TELEMETRY_DISABLED: "1"
  build:
    enabled: false  # Disable build init container - use pre-built images
  service:
    type: ClusterIP
    port: 3000
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

# PostgreSQL configuration
postgresql:
  enabled: true
  image:
    repository: pgvector/pgvector
    tag: pg15
    pullPolicy: IfNotPresent
  auth:
    username: pguser
    # Password will be provided via external secrets or at deployment time
    password: ""  # Will be set via --set flag or external secret
    database: database
  initdbArgs: "-E UTF8 --locale=C"
  service:
    type: ClusterIP
    port: 5432
  persistence:
    enabled: true
    size: 20Gi
    storageClass: ""
    accessMode: ReadWriteOnce
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

# n8n configuration
n8n:
  enabled: true
  image:
    repository: n8nio/n8n
    tag: latest
    pullPolicy: Always
  auth:
    # Basic auth configuration
    basicAuthActive: "true"
    basicAuthUser: "admin"
    # Password will be provided via external secrets or at deployment time
    basicAuthPassword: ""  # Will be set via --set flag or external secret
  env:
    N8N_PERSONAL_API_KEY: ""
    DB_TYPE: "postgresdb"
    DB_POSTGRESDB_HOST: "harvis-ai-pgsql"
    DB_POSTGRESDB_PORT: "5432"
    DB_POSTGRESDB_DATABASE: "n8n"
    DB_POSTGRESDB_USER: "pguser"
    DB_POSTGRESDB_PASSWORD: ""  # Will be set via --set flag or external secret
    N8N_BASIC_AUTH_ACTIVE: "true"
    N8N_BASIC_AUTH_USER: "admin"
    WEBHOOK_URL: "https://n8n.dulc3.tech/"
    GENERIC_TIMEZONE: "America/Los_Angeles"
  service:
    type: ClusterIP
    port: 5678
  persistence:
    enabled: true
    size: 5Gi
    storageClass: ""
    accessMode: ReadWriteOnce
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

# Nginx configuration
nginx:
  enabled: true
  image:
    repository: nginx
    tag: alpine
    pullPolicy: IfNotPresent
  service:
    type: LoadBalancer
    port: 80
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
  tls:
    - secretName: harvis-tls-cert
      hosts:
        - harvis.dulc3.tech
        - harvis-api.dulc3.tech
        - n8n.dulc3.tech
  hosts:
    - host: harvis.dulc3.tech
      paths:
        - path: /
          pathType: Prefix
          service:
            name: nginx
            port: 80
    - host: harvis-api.dulc3.tech
      paths:
        - path: /api
          pathType: Prefix
          service:
            name: merged-backend
            port: 8000
    - host: n8n.dulc3.tech
      paths:
        - path: /
          pathType: Prefix
          service:
            name: n8n
            port: 5678

# Service account configuration
serviceAccount:
  create: true
  name: ""
  annotations: {}

# Pod security context
podSecurityContext:
  fsGroup: 2000

# Security context
securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: false
  runAsUser: 0

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}
